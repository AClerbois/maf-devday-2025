<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan, Do, Check… Agent ! - DevDay 2025</title>
    <link rel="stylesheet" href="styles.css">
  
</head>

<body>
    <div class="slide-container">


    </div>

    <div class="navigation">
        <button id="prevBtn" onclick="changeSlide(-1)">← Précédent</button>
        <button id="nextBtn" onclick="changeSlide(1)">Suivant →</button>
    </div>

    <script>
        // Liste des fichiers de slides à charger
        const slideFiles = [
            "slides_parts/slide01.html", "slides_parts/slide02.html", "slides_parts/slide03.html", "slides_parts/slide04.html", "slides_parts/slide04b.html", "slides_parts/slide05.html",
            "slides_parts/slide06.html", "slides_parts/slide07.html", "slides_parts/slide08.html", "slides_parts/slide09.html", "slides_parts/slide10.html",
            "slides_parts/slide11.html", "slides_parts/slide12.html", "slides_parts/slide13.html", "slides_parts/slide14.html", "slides_parts/slide14b.html", "slides_parts/slide15.html",
            "slides_parts/slide16.html", "slides_parts/slide17.html", "slides_parts/slide17b.html", "slides_parts/slide18.html", "slides_parts/slide18b.html", "slides_parts/slide19.html", "slides_parts/slide20.html",
            "slides_parts/slide21.html", "slides_parts/slide22.html", "slides_parts/slide23.html", "slides_parts/slide24.html", "slides_parts/slide25.html"
        ];

        let currentSlide = 0;
        let slides = [];
        let totalSlides = slideFiles.length;
        const navigation = document.querySelector('.navigation');

        // Fonction pour charger tous les slides
        async function loadSlides() {
            const container = document.querySelector('.slide-container');
            for (let i = 0; i < slideFiles.length; i++) {
                try {
                    const resp = await fetch(slideFiles[i]);
                    const html = await resp.text();
                    // Si le contenu contient déjà <div class="slide"> (même après commentaires ou espaces), on l'ajoute tel quel
                    // Regex simple : ignore espaces/commentaires avant <div class="slide"
                    const slideDivRegex = new RegExp('^([\\s\\n\\r]*|<!--.*?-->)*<div\\s+class=["\\\' ]slide["\\\']', 'i');
                    if (slideDivRegex.test(html)) {
                        container.insertAdjacentHTML('beforeend', html);
                    } else {
                        const slideDiv = document.createElement('div');
                        slideDiv.className = 'slide';
                        slideDiv.innerHTML = html;
                        container.appendChild(slideDiv);
                    }
                } catch (e) {
                    console.error('Erreur chargement', slideFiles[i], e);
                }
            }
            slides = document.querySelectorAll('.slide');
            totalSlides = slides.length;
            // Retire toute classe active résiduelle
            slides.forEach(slide => slide.classList.remove('active'));
            console.log('Slides chargés:', slides.length);
                   
            showSlide(0);
            setupNavigation();
        }

        function setupNavigation() {
            // Navigation visible au survol bas-droite
            if (navigation) {
                let windowWidth = window.innerWidth;
                let windowHeight = window.innerHeight;
                let bottomThreshold = windowHeight * 0.75;
                let rightThreshold = windowWidth * 0.75;

                window.addEventListener('resize', () => {
                    windowWidth = window.innerWidth;
                    windowHeight = window.innerHeight;
                    bottomThreshold = windowHeight * 0.75;
                    rightThreshold = windowWidth * 0.75;
                });

                let lastCheckTime = 0;
                const throttleDelay = 50;

                document.addEventListener('mousemove', (e) => {
                    const now = Date.now();
                    if (now - lastCheckTime < throttleDelay) return;
                    lastCheckTime = now;
                    const mouseX = e.clientX;
                    const mouseY = e.clientY;
                    if (mouseY > bottomThreshold && mouseX > rightThreshold) {
                        navigation.classList.add('visible');
                    } else {
                        navigation.classList.remove('visible');
                    }
                });
            }

            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowLeft' && currentSlide > 0) changeSlide(-1);
                if (e.key === 'ArrowRight' && currentSlide < totalSlides - 1) changeSlide(1);
            });
        }

        function showSlide(n, updateHash = true) {
            if (slides.length === 0) return;
            slides.forEach(slide => slide.classList.remove('active'));
            currentSlide = (n + totalSlides) % totalSlides;
            slides[currentSlide].classList.add('active');
            document.getElementById('prevBtn').disabled = currentSlide === 0;
            document.getElementById('nextBtn').disabled = currentSlide === totalSlides - 1;
            // Met à jour l'URL si demandé
            if (updateHash) {
                window.location.hash = `slide=${currentSlide + 1}`;
            }
            // Contrôle du gif sur le slide 6 (index 5)
            const gif = document.getElementById('slide6-gif');
            if (gif) {
                if (currentSlide === 5) {
                    gif.src = gif.getAttribute('data-gif');
                } else {
                    gif.src = '';
                }
            }
        }

        function changeSlide(direction) {
            showSlide(currentSlide + direction);
        }

        // Navigation directe via l'URL (hash)
        function goToSlideFromHash() {
            const hash = window.location.hash;
            const match = hash.match(/slide=(\d+)/);
            if (match) {
                const slideNum = parseInt(match[1], 10);
                if (!isNaN(slideNum) && slideNum >= 1 && slideNum <= totalSlides) {
                    showSlide(slideNum - 1, false);
                }
            }
        }

        // Expose les fonctions globalement pour les boutons
        window.changeSlide = changeSlide;

        // Charge les slides au chargement de la page
        window.addEventListener('DOMContentLoaded', async () => {
            await loadSlides();
            goToSlideFromHash();
        });

        // Gère le changement manuel du hash (navigation directe)
        window.addEventListener('hashchange', goToSlideFromHash);
    </script>
</body>

</html>